---
title: QUIC协议 和 TCP/UDP 协议
date: 2019-04-11 21:32:16
tags: [Http,QUIC,TCP,UDP]
categories: 前端
---

目的：熟悉了解 QUIC协议 和 TCP/UDP 协议。
<escape><!-- more --></escape>

### TCP/UDP 分别是什么？
`UDP`：全称为用户数据报协议，与 `TCP` 协议一样用于处理数据包，是一种面向无连接不可靠的协议。关注把数据报文传输出去，不关心是否安全到达。
特点： 
1. **面向无连接**（不需要三次握手）
2. **支持一对多，多对多，多对一**
3. **不可靠**（原因：通信都不需要建立连接、没有拥塞控制所以网络条件不好的情况下可能会导致丢包）
4. **传输数据高效**

`TCP`：全称为传输控制协议，是一种面向连接的、可靠的、基于字节流的传输层通信协议，由 IETF 的 RFC 793 定义。TCP 是面向连接的、可靠的流协议。
特点：
1. **面向连接**（存在三次握手）
2. 只能进行**点对点的数据传输**
3. **面向字节流**（TCP 不像 UDP 一样那样一个个报文独立地传输，而是在不保留报文边界的情况下以字节流方式进行传输）
4. **可靠传输**（依靠 TCP 的段编号以及确认序号）
5. **拥塞控制**（网络出现拥塞的时候，TCP 能够减小向网络注入数据的速率和数量，缓解拥塞）
6. **提供全双工通信**（通信双方的应用程序在任何时候都能发送数据）
7. **存在队头阻塞**（使用序列号来标识数据的顺序，数据必须按照顺序处理）


### QUIC 对比 TCP/UDP 的优缺点
`QUIC` 协议是 Google 提出的一套基于 `UDP` 的开源协议，它汇集了 `TCP `和 `UDP` 的优点，传输高效并且可靠。
`QUIC` 的优点：
1. **迭代更新快**（`TCP` 和 `UDP` 协议是操作系统内核实现的，部署进度慢。`QUIC`直接基于客户端实现，能实现快速迭代更新）
2. **没有队头阻塞的多路复用**（`TCP` 使用序列号来标识数据的顺序，数据必须按照顺序处理，可能会造成队头阻塞。HTTP2 支持多路复用，但是由于强制使用 `TLS`，还存在一个 `TLS` 协议层面的队头阻塞，`QUIC` 最基本的传输单元是 Packet，不会超过 MTU 的大小，整个加密和认证过程都是基于 Packet 的，不会跨越多个 Packet。这样就能避免 `TLS` 协议存在的队头阻塞。Stream 之间相互独立，比如 Stream2 丢了一个 Pakcet，不会影响 Stream3 和 Stream4，所以也不存在 TCP 队头阻塞。）
3. **握手更迅速**（`TCP`需三次握手才能建立连接，有等待时延，如果用了`TLS`加密，还会进一步增加时延。`QUIC`采用了类似于`TCP` Fast Open的设计，在之前已经连接过的情况下可以无需握手，直接开始传送数据，连接建立时延为0）
4. **加密技术比`TLS`性能好**，同时具有各种攻击防御策略。
5. **前向纠错**（`QUIC`和`TCP`一个主要的核心区别就是：`TCP`采用 重传 机制，而`QUIC`采用 纠错 机制。如果发生丢包的话，`TCP`首先需要一个等待延时来判断发生了丢包，然后再启动重传机制，在此期间会对连接造成一定的阻塞（并且`TCP`窗口是缓慢增大的，Web这种突发性快速连接情况下窗口会相对较小），从而影响传输时间。而`QUIC`采用了一种脑洞极大的前向纠错（FEC）方案，类似于RAID5，将N个包的校验和（异或）建立一个单独的数据包发送，这样如果在这N个包中丢了一个包可以直接恢复出来，完全不需要重传，有利于保证高速性，N可以根据网络状况动态调整）
6. **连接保持**（TCP 连接 [17] 是由四元组标识的（源 IP，源端口，目的 IP，目的端口），当其中一项发生改变，都需要重新建立和服务端的 TCP 连接。QUIC 连接不再以 IP 及端口四元组标识，而是以一个 64 位的随机数作为 ID 来标识，这样就算 IP 或者端口发生变化时，只要 ID 不变，这条连接依然维持着。这就意味着：在IP地址和端口变化的情况下（比如从Wi-Fi切换到流量），可以无需重新建立连接，继续通信）
7. 能实现证书压缩，**减少证书传输量**，针对包头进行验证等。

`QUIC` 的缺点：
1. `QUIC` 基于 `UDP` ，目前很多网络运营商会降低 `UDP` 包的优先级，使得 `UDP` 丢包率特别高
2. 支持的浏览器少

参考资料：
[下一代通信协议：QUIC](https://juejin.im/post/5a67e8d5f265da3e303ca6fe)
[科普：QUIC协议原理分析](https://zhuanlan.zhihu.com/p/32553477)
[HTTP/3 都来了，你却还在用 HTTP/1.1？](https://mp.weixin.qq.com/s?__biz=MzI4NzEyMjUxMA==&mid=2649068604&idx=1&sn=9d34b782a5d7c147e108f1af1c0fbc23&chksm=f3c3411dc4b4c80b7e8a72013a7b884e21814f6bcbc6f0ea8752ff6c434b93005efc854520ef&xtrack=1&scene=0&subscene=131&clicktime=1552095539&ascene=7&devic)
[TCP和UDP比较](https://github.com/ljianshu/Blog/issues/61)